/**
 * Imagery
 * -------
 * Utility for images and buttons
 * 
 * @version 0.8.1
 * @author mach3
 * @url http://github.com/mach3/imagery
 *
 */

 (function(t){var e=function(){var e=this;e.option={blankGif:"./blank.gif",hoverSuffix:"-hover",activeSuffix:"-active",enterEasing:"swing",enterDuration:100,leaveEasing:"swing",leaveDuration:500,preloadHover:!0,preloadActive:!0},e.dataKey={info:"imageryInfo",alpha:"imageryAlpha",blend:"imageryBlend",active:"imageryActive",base:"imageryBase",above:"imageryAbove"},e.tmpl={filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod='{{method}}', src='{{path}}') alpha(opacity={{opacity}})"},e.msie=!1,e.msieVersion=null,e.init=function(){var t=navigator.userAgent.match(/MSIE\s([\d\.]+?);/);return t&&(this.msie=!0,this.msieVersion=parseInt(t[1],10)),this},e.config=function(e){return t.extend(this.option,e),this},e.run=function(e,i,a){var n;return this.hasOwnProperty(e)&&(n=t.extend([],a),n.unshift(i),this[e].apply(this,n)),this},e.alpha=function(e,i){var a,n;return a=t(e),n=this._getNodeInfo(e),i=t.isNumeric(i)?""+i:100,!this.msie||this.msieVersion>=9||!n.png?this:("img"===n.type?a.css({filter:this._render(this.tmpl.filter,{path:n.src,method:"scale",opacity:i}),width:a.width(),height:a.height()}).attr("src",this.option.blankGif):a.css({backgroundImage:"url("+this.option.blankGif+")",filter:this._render(this.tmpl.filter,{path:n.src,method:"crop",opacity:i})}),a.data(this.dataKey.alpha,!0),this)},e.swapImage=function(e,i){var a,n;return a=t(e),n=this._getNodeInfo(e),a.data(this.dataKey.alpha)?a.css({filter:this._render(this.tmpl.filter,{path:i,method:"img"===n.type?"scale":"crop"})}):"img"===n.type?t(e).attr("src",i):t(e).css("background-image","url("+i+")"),this},e.swapButton=function(i,a){var a,n,r;return a=t.extend({},this.option,a),n=this._getNodeInfo(i),r=[],t(i).hover(function(i){var a="mouseenter"===i.type;t(this).data(e.dataKey.active)||e.swapImage(this,a?n.hover:n.src)}),a.preloadHover&&r.push(n.hover),a.preloadActive&&r.push(n.active),this.preload(r),this},e.blendButton=function(i,a){var n,r,s;return a=t.extend({},this.option,a),n=t(i),r=this._getNodeInfo(i),s=[],this._createAboveNode(n,r.hover).hover(function(i){var n,r;n=t(this),r="mouseenter"===i.type&&!n.data(e.dataKey.base).data(e.dataKey.active),n.stop().animate({opacity:r?1:0},r?a.enterDuration:a.leaveDuration,r?a.enterEasing:a.leaveEasing)}).on("click",function(){t(this).data(e.dataKey.base).trigger("click")}),a.preloadHover&&s.push(r.hover),a.preloadActive&&s.push(r.active),this.preload(s),this},e._createAboveNode=function(e,i){var a=t("<img>").attr({src:i}).css({position:"absolute",opacity:0,width:e.width(),heigth:e.height(),zIndex:e.css("z-index"),left:e.css("left"),top:e.css("top"),right:e.css("right"),bottom:e.css("bottom")}).data(this.dataKey.base,e).insertBefore(e);return e.data(this.dataKey.alpha)&&this.alpha(a.get(0),0),e.data(this.dataKey.blend,!0).data(this.dataKey.above,a),a},e.activate=function(t){return this._activate(t,!0),this},e.deactivate=function(t){return this._activate(t,!1),this},e.preload=function(e,i){var a,n;return"string"==typeof e&&(e=[e]),a=e.length,n=function(){a--,!a&&t.isFunction(i)&&i()},t.each(e,function(t,e){var i=new Image;i.onload=n,i.src=e}),this},e._render=function(t,e){return t.replace(/\{\{(\w+?)\}\}/g,function(t,i){return e[i]||""})},e._getNodeInfo=function(e){var i=t(e);return i.data(this.dataKey.info)||this._initNodeInfo(e),i.data(this.dataKey.info)},e._initNodeInfo=function(e){var i,a,n;return i=t(e),a={},a.type="IMG"===e.nodeName?"img":"common","img"===a.type?a.src=i.prop("src"):(n=i.css("background-image").match(/url\("?(.+?)"?\)/),a.src=n[1]||null),a.hover=a.src.replace(/\.(\w+?)$/,this.option.hoverSuffix+".$1"),a.active=a.src.replace(/\.(\w+?)$/,this.option.activeSuffix+".$1"),a.png=null!==a.src.match(/\.png$/),i.data(this.dataKey.info,a),a},e._activate=function(e,i){var a,n;return a=t(e),n=this._getNodeInfo(e),this.swapImage(e,i?n.active:n.src),a.data(this.dataKey.active,i),a.data(this.dataKey.blend)&&a.data(this.dataKey.above).css("opacity",0),this},e.init.call(this)};t.extend(t,{imagery:new e,imageryConfig:function(e){t.imagery.config(e)}}),t.fn.extend({imagery:function(){var e,i,a,n;for(e=this,a=arguments.length,i=[];a--;)i.push(arguments[arguments.length-a-1]);return n=i.shift(),t.each(n.split(","),function(a,n){n=t.trim(n),n&&e.each(function(){t.imagery.run(n,this,i)})}),this}})})(jQuery);